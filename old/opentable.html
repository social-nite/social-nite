<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Social Nite</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  
</head>

<body>

<div class="panel-body">
        <form id="addTrain">
                    
          <br><label for="zip">City</label><br>
          <input class="form-control" type="text" id="city"><br>
          
          <br><label for="price">Price</label><br>
          <input class="form-control" type="text" id="price"><br>

          <button id="submitBtn">Search</button>
          
          
        </form>
</div>

<div class="row">
  <div id="restaurants" class="col-md-3">Restaurants</div>
  <div id="city" class="col-md-3">City</div>
  <div id="price" class="col-md-3">Price</div>
  <div id="reserve" class="col-md-3">Reserve URL</div>
</div>
  

<script src="https://www.gstatic.com/firebasejs/4.1.2/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDUkT0bSTUaeV64pFeLxZYAfq-E58nKTgs",
    authDomain: "opentable-4abc7.firebaseapp.com",
    databaseURL: "https://opentable-4abc7.firebaseio.com",
    projectId: "opentable-4abc7",
    storageBucket: "",
    messagingSenderId: "723465252656"
  };
  firebase.initializeApp(config);
</script>


<script type="text/javascript">
	
  //Get a reference to the database service
        var database = firebase.database();
        var city;

        $("#submitBtn").on("click", function(event) {
          event.preventDefault();
        // Grab inputs from the textboxes
          city = $("#city").val().trim();
          console.log("city: ",city);
          //var price = $("#price").val().trim();
          //convert from number to $ symbol
          /*if(price === "1") {
              price = "$";
              console.log("price$: ",price);
          }
          else if(price === "2") {
              price = "$$";
              console.log("price$$: ",price);
          }
          else if(price === "3") {
              price = "$$$";
              console.log("price$$$: ",price);
          }
          else if(price === "4") {
              price = "$$$$";
              console.log("price$$$$: ",price);
          }*/
        


        //store the opentable URL
  	   	var queryURL = "https://opentable.herokuapp.com/api/restaurants?city=" + city + "&page=2&per_page=15";
        console.log("inside URL: ",);

        //make ajax call
        $.ajax({
      		url: queryURL,
      		method: "GET"
    	  }).done(function(response) {

        

    	  //Store results from api call
    	  var listRestaurants = response.restaurants;	
        var restNames = [];
        var restPrice = [];
        var restReserve = [];
        var restCity = [];

        //save objects in arrays
        for(var i = 0; i < listRestaurants.length; i++) {
           		restNames = response.restaurants[i].name;
           		restPrice = response.restaurants[i].price;
           		restReserve = response.restaurants[i].reserve_url;
              restCity = response.restaurants[i].city;
            	console.log(restNames);
            	console.log(restPrice);
            	console.log(restReserve);
              console.log(restCity);

              //prep for firebase
              var restaurants = {
              restNames: restNames,
              restPrice: restPrice,
              restReserve: restReserve,
              restCity: restCity
              };
              // Uploads data to firebase
              database.ref().push(restaurants);

    	  	//$("#restaurants").append("<div><a href='" + restNames + "'></a>");
          //$("#price").append("<div>" + restPrice);
          //$("#reserve").append("<div>" + restReserve);
    	  }
    	});
});

    
    

        
        
        var fbRestName;
        var fbPrice;
        var fbReserve;
        var price;
        var fbCity;
        
        //if data in firebase...
        database.ref().on("child_added", function(childSnapshot, prevChildKey) {
        //var cityQuery = firebase.database().ref().child("socialNites/" + socialNitesId + "/city");
            //cityQuery.once("value", function (snapshot) {
            fbRestName = childSnapshot.val().restNames;
            console.log("restName", fbRestName);
            fbPrice = childSnapshot.val().restPrice;
            fbReserve = childSnapshot.val().restReserve;
            fbCity = childSnapshot.val().restCity;

          //convert from price number to $ symbol
            if(fbPrice === 1) {
              price = "$";
              //console.log("price$: ",price);
            }
            else if(fbPrice === 2) {
              price = "$$";
             //console.log("price$$: ",price);
            }
            else if(fbPrice === 3) {
              price = "$$$";
              //console.log("price$$$: ",price);
            }
            else if(fbPrice === 4) {
              price = "$$$$";
              //console.log("price$$$$: ",price);
            }
              
          // Change the HTML
          $("#restaurants").append("<div>" + fbRestName);
          $("#city").append("<div" + fbCity);
          $("#price").append("<div>" + price);
          $("#reserve").append("<div>" + fbReserve);

      

     
    // If any errors are experienced, log them to console.
    }, function(errorObject) {
      console.log("The read failed: " + errorObject.code);
          
    });
     
</script>
</body>
</html>